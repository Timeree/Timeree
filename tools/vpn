#!/usr/bin/env bash

SOCKS5_PORT=10351

if [ $# -gt 0 ]; then
  http_proxy=socks5://127.0.0.1:$SOCKS5_PORT \
  https_proxy=socks5://127.0.0.1:$SOCKS5_PORT \
  "$@"
  exit #?
fi

am start -n com.github.metacubex.clash.meta/com.github.kr328.clash.MainActivity

CODESPACE_NAME=$(gh cs ls --json name --jq '.[0].name')

trap '
  am start -n com.github.metacubex.clash.meta/com.github.kr328.clash.MainActivity
  gh cs stop -c $CODESPACE_NAME
  echo "Exit"
' EXIT;

echo $CODESPACE_NAME

gh cs ssh -c $CODESPACE_NAME -- \
  -L $SOCKS5_PORT:localhost:$SOCKS5_PORT \
  "
    microsocks -p $SOCKS5_PORT
  "

# curl -sL https://raw.githubusercontent.com/Timeree/Timeree/main/tools/vpn | bash;

