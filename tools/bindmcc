#!/usr/bin/env bash

CODESPACE_NAME=$(gh cs ls --json name --jq '.[0].name')

trap '
  gh cs stop -c $CODESPACE_NAME
' EXIT;

echo $CODESPACE_NAME

(while true; do
  sleep 180
  echo "#runing..."
done) | gh cs ssh -c $CODESPACE_NAME -- \
  "
    (
      sleep 5
      echo \"/l $MCC_PASSWORD\" &
      sleep 2
      echo \"/home\" &
      (while true; do
        sleep 180
        echo \"/\"
      done) &
    ) | ~/mccx86 $MCC_USERNAME - $MCC_SERVER &
    sleep 10
    
    (
      sleep 5
      echo \"/l $MCC_PASSWORD\" &
      sleep 2
      echo \"/home\" &
      (while true; do
        sleep 180
        echo \"/\"
      done) &
    ) | ~/mccx86 $MCC_USERNAME2 - $MCC_SERVER
    exit
  "


