
import asyncio
import edge_tts
import simpleaudio as sa  # 用来直接播放音频流

async def main():
    # 选择发音人
    voice = "zh-CN-XiaoxiaoNeural"
    text = "我是小小，一个温柔自然的声音，正在流式播放。江西想看看斗罗大陆三零点肯德基嗯是看快手快递徐喜欢过的哈绿区啊擦发套暗恋的肯定哭兮兮欧洲怕屁啊US"

    # 初始化 TTS
    communicate = edge_tts.Communicate(text, voice)

    # 流式获取音频
    async for chunk in communicate.stream():
        if chunk["type"] == "audio":
            # 播放音频数据
            play_obj = sa.play_buffer(
                chunk["data"],
                num_channels=1,
                bytes_per_sample=2,
                sample_rate=24000
            )
            play_obj.wait_done()

asyncio.run(main())
