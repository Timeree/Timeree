#!/usr/bin/env bash

am start -n com.github.metacubex.clash.meta/com.github.kr328.clash.MainActivity;

name=$(gh cs ls --json name --jq '.[0].name');
port=10351;

trap '
  am start -n com.github.metacubex.clash.meta/com.github.kr328.clash.MainActivity;
  gh cs stop -c $name;
  echo "Exit";
' EXIT;

echo "Waiting...";

gh cs ssh -c $name -- -L $port:localhost:$port "microsocks -p $port; read -n 1000";

# curl -sL https://raw.githubusercontent.com/Timeree/Timeree/main/vpn/bindSocks5 | bash;