#!/usr/bin/env bash


name=$(gh cs ls --json name --jq '.[0].name');
port=1080;

trap '
  gh cs stop -c $name;
' EXIT;

# am start -n com.github.metacubex.clash.meta/com.github.kr328.clash.MainActivity;

echo "Waiting...";

gh cs ssh -c $name "nohup microsocks -p $port & exit";

sleep 2

gh cs ports -c $name forward $port:$port;

while true; do
    read -n 1 -r char
    if [ "$char" = " " ]; then
        echo -e "\nStop."
        break
    fi
done

